<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopkeeper Orders</title>
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, onChildAdded, remove } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        // Firebase configuration
       const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "grocer-40524.firebaseapp.com",
  databaseURL: "https://grocer-40524-default-rtdb.firebaseio.com",
  projectId: "grocer-40524",
  storageBucket: "grocer-40524.firebasestorage.app",
  messagingSenderId: "841700554306",
  appId: "1:841700554306:web:589eb6aa59fe842ad71fdb",
  measurementId: "G-H8S1SYL59Q"
};


        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        function fetchOrders() {
            const ordersRef = ref(db, 'slp');
            onChildAdded(ordersRef, (snapshot) => {
                const ordersDiv = document.getElementById('orders');
                const orderKey = snapshot.key;
                const orderValue = snapshot.val();
                
                console.log("New Order Data:", orderValue); // Debugging output

                const orderElement = document.createElement('div');
                orderElement.classList.add('order');
                orderElement.innerHTML = `
                    <p><strong>Order:</strong> <span>${orderKey} - ${orderValue}</span></p>
                    <button onclick="markCompleted('${orderKey}', this)">Complete</button>
<button onclick="redirectToTrackingPage('${orderKey}')">Track Order</button>


                `;
                ordersDiv.appendChild(orderElement);
                
                // Show notification
                showNotification("New Order Received!", `Order: ${orderKey} - ${orderValue}`);
            });
        }

        window.markCompleted = function(orderKey, button) {
            const orderRef = ref(db, `slp/${orderKey}`);
            const orderElement = button.parentElement;
            orderElement.querySelectorAll('span').forEach(span => span.style.textDecoration = "line-through");
            setTimeout(() => orderElement.remove(), 1000); // Remove after 1 sec
            remove(orderRef);
        }
window.redirectToTrackingPage = function(orderKey) {
            // Redirect to the tracking page for the specific order
            window.location.href = `trak.html?order=${orderKey}`;
        }

        function showNotification(title, message) {
            if (Notification.permission === "granted") {
                new Notification(title, { body: message });
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") {
                        new Notification(title, { body: message });
                    }
                });
            }
        }

        // Request notification permission
        if (Notification.permission !== "granted") {
            Notification.requestPermission();
        }

        window.onload = fetchOrders;
    </script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h2 { text-align: center; }
        .order-container { max-width: 600px; margin: auto; }
        .order { border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; display: flex; flex-direction: column; align-items: center; }
        .order button { background-color: #28a745; color: white; border: none; padding: 5px 10px; cursor: pointer; margin: 5px; }
    </style>
</head>
<body>
    <h2>Shopkeeper Order Management</h2>
    <div class="order-container" id="orders"></div>
</body>
</html>

